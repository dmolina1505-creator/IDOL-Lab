// Source code is decompiled from a .class file using FernFlower decompiler (from Intellij IDEA).
import java.util.ArrayList;
import java.util.List;
import java.util.Optional;
import java.util.Random;

class GameState {
   int day = 1;
   int month = 1;
   int year = 1;
   Player player;
   Company company;
   int traineeFailures = 0;
   final List<String> messageLog = new ArrayList();
   final Random rng = new Random();

   GameState(Player var1, Company var2) {
      this.player = var1;
      this.company = var2;
   }

   void advanceDay() {
      ++this.day;
      if (this.day > 30) {
         this.day = 1;
         ++this.month;
         if (this.month > 12) {
            this.month = 1;
            ++this.year;
         }

         this.messageLog.add(this.monthlyEvaluation());
      }

   }

   String monthlyEvaluation() {
      if (this.player != null && "Trainee".equals(this.player.role) && this.player.character != null) {
         Trainee var5 = this.player.character;
         int var2 = var5.score() + var5.popularity;
         int var3 = 220 + this.year * 10;
         if (var2 >= var3) {
            var5.adjustRelationship(5);
            var5.adjustPopularity(5);
            return "Monthly evaluation passed! Score " + var2 + " / " + var3 + ". Relationship +5.";
         } else {
            ++this.traineeFailures;
            int var4 = this.randomBetween(this.rng, 5, 10);
            var5.adjustRelationship(-var4);
            return "Evaluation failed. Score " + var2 + " / " + var3 + ". Relationship -" + var4 + ".";
         }
      } else if (this.company != null) {
         int var1 = this.company.groups.stream().mapToInt((var0) -> {
            return var0.popularity / 2;
         }).sum();
         this.company.updateFinances(var1);
         return "Monthly income report: earned " + var1 + " from active groups.";
      } else {
         return "The month rolls by without major events.";
      }
   }

   Optional<String> checkVictoryOrDefeat() {
      if (this.player != null && "CEO".equals(this.player.role) && this.company != null) {
         if (this.company.money < -2000) {
            return Optional.of("Bankruptcy! Your company could not pay its bills.");
         }

         boolean var1 = this.company.groups.stream().anyMatch((var0) -> {
            return var0.popularity >= 300;
         });
         if (var1) {
            return Optional.of("Success! One of your groups became a top act.");
         }

         if (this.year > 5) {
            return Optional.of(this.company.reputation < 80 ? "Time's up. The industry moved on before you produced a hit." : "Legendary CEO!");
         }
      }

      if (this.player != null && "Trainee".equals(this.player.role) && this.player.character != null) {
         Trainee var2 = this.player.character;
         if (var2.popularity >= 200 && var2.score() >= 350) {
            return Optional.of("You debuted and became a sensation!");
         }

         if (this.traineeFailures >= 3) {
            return Optional.of("You were cut after repeated failed evaluations.");
         }

         if (this.year > 5) {
            return Optional.of(var2.popularity < 150 ? "The window closed before you could debut." : "Late bloomer debut success!");
         }
      }

      return Optional.empty();
   }

   private int randomBetween(Random var1, int var2, int var3) {
      return var2 + var1.nextInt(Math.max(1, var3 - var2 + 1));
   }
}
